# FanMacro AI ä»£ç ç”ŸæˆæœåŠ¡å™¨ - é¡¹ç›®æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. HTTP æœåŠ¡å™¨
- **ç«¯å£**: 9999
- **æ¡†æ¶**: Java HTTP Server (å†…ç½®)
- **çŠ¶æ€**: âœ… å·²å®ç°

### 2. API ç«¯ç‚¹

#### POST /input
- **åŠŸèƒ½**: æ¥æ”¶ç”¨æˆ·éœ€æ±‚ï¼Œç”Ÿæˆä»»åŠ¡ ID
- **è¯·æ±‚ä½“**:
  ```json
  {
    "IP": "",
    "text": "ç”¨æˆ·çš„åŠŸèƒ½éœ€æ±‚æè¿°"
  }
  ```
- **å“åº”**:
  ```json
  {
    "code": 200,
    "takeid": "éšæœº8ä½å°å†™å­—æ¯"
  }
  ```
- **çŠ¶æ€**: âœ… å·²å®ç°

#### GET /output?takeid=xxx
- **åŠŸèƒ½**: æŸ¥è¯¢ä»£ç ç”Ÿæˆç»“æœ
- **å“åº”**:
  - å¦‚æœä»£ç è¿˜æœªç”Ÿæˆ: è¿”å›æ–‡æœ¬ `wait`
  - å¦‚æœä»£ç å·²ç”Ÿæˆ: è¿”å›ç”Ÿæˆçš„ä»£ç ï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰
  - æŸ¥è¯¢åï¼Œè¯¥ takeid ä¼šè¢«åˆ é™¤
- **çŠ¶æ€**: âœ… å·²å®ç°

### 3. è®¯é£æ˜Ÿç« API é›†æˆ
- **API åœ°å€**: `https://spark-api-open.xf-yun.com/v1/chat/completions`
- **æ¨¡å‹**: `generalv3.5` (æ˜Ÿç« Lite)
- **API å¯†é’¥**: å·²é…ç½®
- **åŠŸèƒ½**: 
  - å¼‚æ­¥è°ƒç”¨ AI API
  - æ„å»ºåŒ…å« FanMacro æ–‡æ¡£çš„æç¤ºè¯
  - è§£æ AI å“åº”
- **çŠ¶æ€**: âœ… å·²å®ç°

### 4. FanMacro æ–‡æ¡£åŠ è½½
- **è‡ªåŠ¨æŸ¥æ‰¾è·¯å¾„**:
  1. `../autosaveforForgeç¤ºä¾‹é¡¹ç›®/FanMacrodoc.md`
  2. `../../autosaveforForgeç¤ºä¾‹é¡¹ç›®/FanMacrodoc.md`
  3. `FanMacrodoc.md`
- **åŠŸèƒ½**: å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½æ–‡æ¡£å†…å®¹
- **çŠ¶æ€**: âœ… å·²å®ç°

### 5. ä»»åŠ¡ç®¡ç†
- **å­˜å‚¨**: ä½¿ç”¨ `ConcurrentHashMap` å­˜å‚¨ä»»åŠ¡çŠ¶æ€
- **åŠŸèƒ½**:
  - ç”Ÿæˆéšæœº 8 ä½å°å†™å­—æ¯ takeid
  - å¼‚æ­¥å¤„ç† AI è¯·æ±‚
  - æŸ¥è¯¢åè‡ªåŠ¨åˆ é™¤ä»»åŠ¡
- **çŠ¶æ€**: âœ… å·²å®ç°

## ğŸ“ é¡¹ç›®ç»“æ„

```
PlayerBot-Macro-GUI-server/
â”œâ”€â”€ build.gradle              # æ„å»ºé…ç½®ï¼ˆå·²æ·»åŠ  UTF-8 ç¼–ç æ”¯æŒï¼‰
â”œâ”€â”€ settings.gradle           # é¡¹ç›®è®¾ç½®
â”œâ”€â”€ README.md                 # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ run-server.bat            # Windows å¯åŠ¨è„šæœ¬
â”œâ”€â”€ run-server.sh             # Linux/Mac å¯åŠ¨è„šæœ¬
â””â”€â”€ src/
    â””â”€â”€ main/
        â””â”€â”€ java/
            â””â”€â”€ com/
                â””â”€â”€ xiaofan/
                    â””â”€â”€ server/
                        â””â”€â”€ FanMacroAIServer.java  # ä¸»æœåŠ¡å™¨ç±»
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Java 17+**
- **Java HTTP Server** (å†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–)
- **OkHttp 4.12.0** (HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºè°ƒç”¨è®¯é£æ˜Ÿç« API)
- **Gson 2.10.1** (JSON å¤„ç†)

## ğŸš€ è¿è¡Œæ–¹å¼

### æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**Windows:**
```cmd
run-server.bat
```

**Linux/Mac:**
```bash
chmod +x run-server.sh
./run-server.sh
```

### æ–¹æ³•2ï¼šä½¿ç”¨ Gradle

```bash
cd PlayerBot-Macro-GUI-server
./gradlew run
```

### æ–¹æ³•3ï¼šè¿è¡Œ JAR æ–‡ä»¶

```bash
cd PlayerBot-Macro-GUI-server
./gradlew build
java -jar build/libs/PlayerBot-Macro-GUI-server-1.0-SNAPSHOT.jar
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. æäº¤éœ€æ±‚

```bash
curl -X POST http://localhost:9999/input \
  -H "Content-Type: application/json" \
  -d '{
    "IP": "",
    "text": "åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æŒ–çŸ¿çš„å®ï¼ŒæŒ–æ˜é“çŸ¿çŸ³"
  }'
```

**å“åº”:**
```json
{
  "code": 200,
  "takeid": "abcdefgh"
}
```

### 2. æŸ¥è¯¢ç»“æœï¼ˆè½®è¯¢ï¼‰

```bash
# ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ˆå¯èƒ½è¿˜åœ¨ç”Ÿæˆä¸­ï¼‰
curl http://localhost:9999/output?takeid=abcdefgh
# å“åº”: wait

# ç­‰å¾…å‡ ç§’åå†æ¬¡æŸ¥è¯¢
curl http://localhost:9999/output?takeid=abcdefgh
# å“åº”: ç”Ÿæˆçš„ FanMacro ä»£ç 
```

## âš™ï¸ é…ç½®è¯´æ˜

### API å¯†é’¥
åœ¨ `FanMacroAIServer.java` ä¸­é…ç½®ï¼š
```java
private static final String SPARK_API_KEY = "tIspeTChASBtfbqUBMqU:kMtkUFZNFrfqIdGsomSz";
```

### æ¨¡å‹ç‰ˆæœ¬
å½“å‰ä½¿ç”¨æ˜Ÿç« Lite æ¨¡å‹ (`generalv3.5`)ï¼Œå¯åœ¨ä»£ç ä¸­ä¿®æ”¹ã€‚

### æç¤ºè¯æ¨¡æ¿
åœ¨ `buildPrompt()` æ–¹æ³•ä¸­å®šä¹‰ï¼ŒåŒ…å«ï¼š
- FanMacro æ–‡æ¡£å†…å®¹
- ç”¨æˆ·éœ€æ±‚
- ç”Ÿæˆè¦æ±‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–‡æ¡£è·¯å¾„**: ç¡®ä¿ `FanMacrodoc.md` æ–‡ä»¶åœ¨å¯è®¿é—®çš„ä½ç½®
2. **API å¯†é’¥**: éœ€è¦æœ‰æ•ˆçš„è®¯é£æ˜Ÿç« API å¯†é’¥
3. **ä»»åŠ¡æ¸…ç†**: å½“å‰å®ç°ä¸­ï¼Œä»»åŠ¡åœ¨æŸ¥è¯¢åä¼šè¢«åˆ é™¤ï¼ŒæœªæŸ¥è¯¢çš„ä»»åŠ¡ä¼šä¿ç•™åœ¨å†…å­˜ä¸­
4. **ç¼–ç é—®é¢˜**: å·²è®¾ç½® UTF-8 ç¼–ç ï¼Œé¿å…ä¸­æ–‡ä¹±ç 

## ğŸ”„ å·¥ä½œæµç¨‹

1. å®¢æˆ·ç«¯å‘é€ POST `/input` è¯·æ±‚ï¼ŒåŒ…å«ç”¨æˆ·éœ€æ±‚
2. æœåŠ¡å™¨ç”Ÿæˆ takeidï¼Œåˆ›å»ºä»»åŠ¡ï¼Œå¼‚æ­¥è°ƒç”¨ AI API
3. å®¢æˆ·ç«¯è½®è¯¢ GET `/output?takeid=xxx` æŸ¥è¯¢ç»“æœ
4. å¦‚æœ AI è¿˜åœ¨ç”Ÿæˆï¼Œè¿”å› `wait`
5. å¦‚æœ AI å·²å®Œæˆï¼Œè¿”å›ç”Ÿæˆçš„ä»£ç ï¼Œå¹¶åˆ é™¤ä»»åŠ¡

## ğŸ“Š çŠ¶æ€

- âœ… HTTP æœåŠ¡å™¨
- âœ… /input ç«¯ç‚¹
- âœ… /output ç«¯ç‚¹
- âœ… è®¯é£æ˜Ÿç« API é›†æˆ
- âœ… FanMacro æ–‡æ¡£åŠ è½½
- âœ… ä»»åŠ¡ç®¡ç†
- âœ… ç¼–ç é—®é¢˜ä¿®å¤
- âœ… å¯åŠ¨è„šæœ¬

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **ä»»åŠ¡è¿‡æœŸæ¸…ç†**: æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œæ¸…ç†é•¿æ—¶é—´æœªæŸ¥è¯¢çš„ä»»åŠ¡
2. **é”™è¯¯å¤„ç†**: å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. **é…ç½®å¤–éƒ¨åŒ–**: å°† API å¯†é’¥ã€ç«¯å£ç­‰é…ç½®ç§»åˆ°é…ç½®æ–‡ä»¶
4. **é™æµä¿æŠ¤**: æ·»åŠ è¯·æ±‚é™æµï¼Œé˜²æ­¢ API è°ƒç”¨è¿‡å¤š
5. **WebSocket æ”¯æŒ**: å¯é€‰ï¼Œæ”¯æŒå®æ—¶æ¨é€ç”Ÿæˆç»“æœ

---

**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

