# FanMacro GUI 新功能说明

## ✅ 已实现的改进

### 1. 自动连接功能

**功能说明：**
- 当您拖拽积木靠近其他积木时，会自动检测并高亮显示可以连接的积木（绿色边框）
- 释放鼠标时，如果积木在连接范围内（80像素），会自动连接
- 连接的积木会自动对齐位置（垂直排列，X坐标对齐）

**使用方法：**
1. 从左侧积木面板点击积木添加到画布
2. 拖拽积木靠近另一个积木
3. 当积木高亮显示时，释放鼠标
4. 积木会自动连接并对齐

**连接规则：**
- 只能从上往下连接（上面的积木连接到下面的积木）
- 连接距离阈值：80像素
- 自动连接时会断开目标积木的旧连接

### 2. 顺序调整功能

**功能说明：**
- 通过右键菜单可以调整积木的执行顺序
- 支持上移、下移操作
- 支持断开连接

**使用方法：**
1. **右键点击积木**，弹出菜单
2. 选择以下选项：
   - **上移**：将积木向上移动一个位置（在连接链中）
   - **下移**：将积木向下移动一个位置（在连接链中）
   - **断开连接**：断开当前积木与下一块积木的连接
   - **删除**：删除积木

**顺序调整规则：**
- 上移/下移会重新排列积木的连接顺序
- 调整顺序后，积木位置会自动对齐
- 代码生成会按照连接顺序，而不是画布上的位置顺序

### 3. 改进的代码生成

**功能说明：**
- 代码生成现在按照积木的连接顺序，而不是画布上的位置
- 支持多个独立的积木链（从不同的根节点开始）
- 自动识别函数定义和主程序

**生成规则：**
1. 首先生成所有函数定义（按照连接顺序）
2. 然后生成 `fan_main:` 主入口点（如果有）
3. 最后生成主程序（按照连接顺序，从没有前驱的积木开始）

## 🎯 使用技巧

### 创建积木链

1. **方法1：自动连接**
   - 添加第一块积木
   - 添加第二块积木，拖拽到第一块积木下方
   - 释放鼠标，积木会自动连接

2. **方法2：手动调整**
   - 添加多块积木到画布
   - 右键点击积木，使用"上移"/"下移"调整顺序
   - 积木会自动连接并对齐

### 调整执行顺序

1. 右键点击要调整的积木
2. 选择"上移"或"下移"
3. 积木会在连接链中移动位置
4. 代码预览会实时更新

### 断开连接

1. 右键点击积木
2. 选择"断开连接"
3. 积木会断开与下一块积木的连接
4. 可以重新连接或创建新的连接链

## 📋 示例场景

### 场景1：创建简单的挖矿宏

1. 点击"主入口点"积木（橙色）
2. 点击"移动到坐标"积木（蓝色），拖拽到主入口点下方，自动连接
3. 点击"挖掘矿石"积木（蓝色），拖拽到"移动到坐标"下方，自动连接
4. 查看右侧代码预览
5. 手动编辑代码中的坐标和矿石类型
6. 保存宏文件

### 场景2：调整积木顺序

假设您已经创建了以下积木链：
```
积木A → 积木B → 积木C
```

想要将顺序改为：
```
积木A → 积木C → 积木B
```

操作步骤：
1. 右键点击"积木C"，选择"上移"
2. 积木C会移动到积木B之前
3. 连接顺序自动更新

### 场景3：创建分支结构

1. 创建主积木链：`积木A → 积木B`
2. 添加"积木C"，不连接到主链
3. 添加"积木D"，连接到"积木C"
4. 现在有两个独立的积木链：
   - 链1：`积木A → 积木B`
   - 链2：`积木C → 积木D`
5. 代码生成会按照连接顺序生成两个链的代码

## ⚠️ 注意事项

1. **连接方向**：只能从上往下连接，不能从下往上
2. **自动对齐**：连接后积木会自动对齐，X坐标相同，Y坐标间隔60像素
3. **断开连接**：断开连接后，积木位置不会自动调整，需要手动拖拽
4. **代码生成**：代码按照连接顺序生成，画布上的位置不影响代码顺序
5. **视觉反馈**：拖拽积木时，可以连接的积木会显示绿色高亮

## 🎉 享受使用！

现在您可以：
- ✅ 通过拖拽自动连接积木
- ✅ 通过右键菜单调整积木顺序
- ✅ 按照连接顺序生成代码
- ✅ 创建复杂的积木结构

开始创建您的 FanMacro 宏文件吧！

